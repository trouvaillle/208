---
layout: post
title:  "03. 저장소와 검색 - Section 1"
date:   2024-07-20 00:00:00 +0900
categories: study books data-intensive-applications
author: 유석모
announced_on: 2024년 7월 23일
---
# 학습할 것

## 데이터 구조

<kbd>세상에서 제일 간단한 데이터베이스</kbd>
```sh
#!/bin/bash

db_set () {
    echo "$1,$2" >> database
}

db_get () {
    grep "^$1," database | sed -e "s/^$1,//" | tail -n 1
}
```

<div class="area-1">
    <div class="cli-container">
        <div class="cli-wrapper console-1">
            <div class="title">
                <code>functions.sh</code>
            </div>
            <textarea id="console-1" class="cli console-1" rows="16" value="$ "></textarea>
        </div>
        <div class="cli-wrapper file-1">
            <div class="title">
                <code>database</code>
            </div>
            <div class="cli file-1">
                <p id="file-1"></p>
            </div>
        </div>
    </div>
</div>

## SS테이블과 LSM 트리


<!---------------------- script ---------------------->
<script type="text/javascript">
window.onload = () => {
    const console1 = document.querySelector('#console-1');
    const file1 = document.querySelector('#file-1');

    let text = '$ ';
    let cursor = 2;
    let database = `123456,{"name":"London","attractions":["Big Ben","London Eye"]}
42,{"name":"San Francisco","attractions":["Golden Gate Bridge"]}
42,{"name":"San Francisco","attractions":["Exploratorium"]}
`;
    let lastInput = [];
    let lastIndex = 0;

    console1.value = text;
    file1.innerText = database;

    console1.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            const end = console1.value.length;
            if (end === cursor) {
                return;
            }
            const input = console1.value.slice(cursor, end);
            text = console1.value + "\n";

            args = input.split(' ');
            switch (args[0].toLowerCase()) {
                case 'clear':
                case 'cls':
                    text = '$ ';
                    cursor = 2;
                    console1.value = text;
                    break;
                case 'db_set':
                    if (args.length <= 2) {
                        text += "db_set needs at least 2 arguments."
                    } else {
                        text += "done."
                        database += args[1] + "," + args[2] + "\n";
                        file1.innerText = database;
                    }
                    text += "\n\n$ ";
                    break;
                case 'db_get':
                    if (args.length <= 1) {
                        text += "db_get needs at least 1 arguments."
                    } else {
                        matches = database.split('\n')
                            .filter(i => i.startsWith(args[1] + ','))
                            .map(i => i.slice(args[1].length + 1))
                        if (matches.length > 0) {
                            text += matches[matches.length - 1];
                        } else {
                            text += "no record was found.";
                        }
                        file1.innerText = database;
                    }
                    text += "\n\n$ ";
                    break;
                case 'cat':
                    if (args.length <= 1) {
                        text += "cat needs at least 1 arguments."
                    } else {
                        if (args[1] === 'database') {
                            text += database;
                        } else {
                            text += "file not exists.";
                        }
                    }
                    text += "\n\n$ ";
                    break;
                case 'ls':
                    text += "database\n\n$ ";
                    break;
                default:
                    text += "unknown command.";
                    text += "\n$ ";
                    break;
            }
            lastInput.push(input);
            lastIndex = lastInput.length - 1;

            console1.value = text;
            cursor = text.length;
            console1.scrollTop = console1.scrollHeight;
        } else {
            if (console1.selectionStart < cursor) {
                e.preventDefault();
                console1.value += e.key;
                console1.selectionStart = console1.value.length;
            }
        }
    });

    console1.addEventListener('keydown', (e) => {
        switch (e.key) {
            case 'Backspace':
                const end = console1.value.length;
                if (cursor >= end) {
                    e.preventDefault();
                }
                break;
            case 'ArrowUp':
                e.preventDefault();
                if (lastInput.length === 0) {
                    break;
                }
                console1.value = text + lastInput[lastIndex];
                --lastIndex;
                if (lastIndex < 0) {
                    lastIndex = lastInput.length - 1;
                }
                break;
            case 'ArrowDown':
                e.preventDefault();
                if (lastInput.length === 0) {
                    break;
                }
                console1.value = text + lastInput[lastIndex];
                ++lastIndex;
                if (lastIndex > lastInput.length - 1) {
                    lastIndex = 0;
                }
                break;
            default:
                break;
        }
        console.log(e.key);
    });

    console1.addEventListener('input', (e) => {
        if (cursor > console1.value.length) {
            console1.value = text;
        }
    });
};
</script>


<!---------------------- style ---------------------->
<style type="text/css">

.area-1 {
    display: flex; 
    justify-content: center; 
    padding: 2rem 2rem 3rem 2rem;
}

.cli-container {
    display: flex; 
    width: 100%;
}

.cli-wrapper {
    flex: 1 1; 
    display: flex;
    flex-direction: column;
}

.cli-wrapper .title {
    flex: 0 1;
    margin: 0.5rem 0;
}

.cli {
    flex: 1 1;
    background: black; 
    color: white;
    font: 0.875rem Consolas, Monaco, D2 Coding, monospace;
    padding: 1rem;
}

.cli.console-1 {
    text-align: left;
    resize: none;
}

.cli.file-1 {
    height: 100%;
    overflow: scroll;
}

.cli-wrapper.file-1 p {
    margin: 0;
    margin-block-start: 0;
    margin-block-end: 0;
}

.cli-wrapper.console-1 {
    margin-right: 1rem;
}

.cli-wrapper.console-1:focus {
    outline: none;
}

@media print, screen and (max-width: 960px) {
    .cli-container {
        width: 100%;
        flex-direction: column;
    }

    .cli-wrapper.console-1 {
        margin: 0;
    }

    .cli-wrapper.file-1 p {
        height: 15rem;
    }
}

</style>